Я создал телеграм-бота по поиску дешёвых билетов на Рейнэйр, через неофициальный Рейнэйр_Апи. Он работает на сервере pythonanywhere.com. К сожалению, он не правильно работает. Во-первых, чтобы активировать бота нужно запустить команду /start, но не единожды, а дважды. Далее, при нажатии кнопки появляется следующее меню. Нужно исправить так, чтобы старт нужно было нажимать один раз. Во-вторых, когда доходит до поиска билетов, скрипт зависает. В лог файле выпадает ошибка, что невозможно связаться с сайтом https://www.ryanair.com/. Хотя, как я уже сказал, это неофициальный Рейнэйр_Апи. Ниже я тебе предоставлю все файлы, включая, лог-файл. Исправь проблему. .env:'TELEGRAM_TOKEN=7713206299:AAG1IujWcXQPMKvgaIeoHKmsHRGWU02-zb8 WEBHOOK_HOST=masteryodo.pythonanywhere.com WEBHOOK_PORT=443 WEBHOOK_URL_PATH=/webhook', app.py:'from flask import Flask, request from telegram import Update from bot import create_application from config import WEBHOOK_URL, WEBHOOK_URL_PATH import logging import asyncio from telegram.ext import Application # Настройка логирования logging.basicConfig( format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO ) logger = logging.getLogger(__name__) # Создание Flask приложения app = Flask(__name__) # Глобальные переменные telegram_app = None event_loop = None def get_event_loop(): """Получение или создание event loop""" global event_loop try: event_loop = asyncio.get_event_loop() except RuntimeError: event_loop = asyncio.new_event_loop() asyncio.set_event_loop(event_loop) return event_loop def init_telegram(): """Инициализация Telegram бота""" global telegram_app if telegram_app is None: loop = get_event_loop() telegram_app = create_application() try: # Инициализируем приложение loop.run_until_complete(telegram_app.initialize()) # Устанавливаем webhook loop.run_until_complete(telegram_app.bot.set_webhook(url=WEBHOOK_URL)) logger.info(f"Webhook установлен на {WEBHOOK_URL}") except Exception as e: logger.error(f"Ошибка при инициализации: {e}") # Инициализируем бота при старте init_telegram() @app.route(WEBHOOK_URL_PATH, methods=['POST']) def webhook(): """Обработчик webhook-запросов от Telegram.""" if telegram_app is None: init_telegram() try: logger.info("Получен webhook запрос") update = Update.de_json(request.get_json(force=True), telegram_app.bot) logger.info(f"Получен update: {update}") loop = get_event_loop() loop.run_until_complete(telegram_app.process_update(update)) return 'OK', 200 except Exception as e: logger.error(f"Ошибка при обработке update: {e}") return 'Error', 500 @app.route('/') def index(): return 'Bot is running'', bot.py:'', config.py:'import os from dotenv import load_dotenv # Загрузка переменных окружения из .env load_dotenv() # Настройки бота TELEGRAM_TOKEN = os.getenv('TELEGRAM_TOKEN') # Настройки webhook WEBHOOK_HOST = os.getenv('WEBHOOK_HOST', 'masteryodo.pythonanywhere.com') WEBHOOK_PORT = int(os.getenv('WEBHOOK_PORT', 443)) WEBHOOK_URL_PATH = os.getenv('WEBHOOK_URL_PATH', '/webhook') WEBHOOK_URL = f"https://{WEBHOOK_HOST}{WEBHOOK_URL_PATH}" # Flask настройки FLASK_HOST = '0.0.0.0' FLASK_PORT = int(os.getenv('FLASK_PORT', 8443))', requirements.txt:'python-telegram-bot==20.6 python-dotenv==1.0.1 Flask==2.3.2 ryanair-py==3.0.0 ', set_webhook.py:'import asyncio from telegram import Bot from config import TELEGRAM_TOKEN, WEBHOOK_URL async def set_webhook(): """Устанавливает webhook для бота.""" bot = Bot(token=TELEGRAM_TOKEN) await bot.set_webhook(url=WEBHOOK_URL) print('Webhook успешно установлен.') if __name__ == '__main__': asyncio.run(set_webhook())', /var/www/masteryodo_pythonanywhere_com_wsgi.py:'import sys import os import site # Путь к виртуальному окружению VENV_PATH = '/home/MasterYodo/freetourprobot/venv' SITE_PACKAGES = os.path.join(VENV_PATH, 'lib', 'python3.10', 'site-packages') site.addsitedir(SITE_PACKAGES) # Добавление пути к директории проекта PROJECT_HOME = '/home/MasterYodo/freetourprobot' if PROJECT_HOME not in sys.path: sys.path.insert(0, PROJECT_HOME) # Загрузка .env файла from dotenv import load_dotenv load_dotenv(os.path.join(PROJECT_HOME, '.env')) import nest_asyncio nest_asyncio.apply() # Импорт Flask приложения from app import app as application', masteryodo.pythonanywhere.com.error.log:'2024-12-09 16:21:36,082: Получен webhook запрос 2024-12-09 16:21:36,087: Получен update: Update(message=Message(channel_chat_created=False, chat=Chat(first_name='Obi', id=708838660, last_name='Van', type=, username='ObiVan1978'), date=datetime.datetime(2024, 12, 9, 16, 21, 26, tzinfo=), delete_chat_photo=False, entities=(MessageEntity(length=6, offset=0, type=),), from_user=User(first_name='Obi', id=708838660, is_bot=False, language_code='uk', last_name='Van', username='ObiVan1978'), group_chat_created=False, message_id=648, supergroup_chat_created=False, text='/start'), update_id=239384371) 2024-12-09 16:21:36,089: Получена команда /start от пользователя 708838660 2024-12-09 16:21:36,226: HTTP Request: POST https://api.telegram.org/bot7713206299:AAG1IujWcXQPMKvgaIeoHKmsHRGWU02-zb8/sendMessage "HTTP/1.1 200 OK" 2024-12-09 16:21:36,316: Получен webhook запрос 2024-12-09 16:21:36,318: Получен update: Update(message=Message(channel_chat_created=False, chat=Chat(first_name='Obi', id=708838660, last_name='Van', type=, username='ObiVan1978'), date=datetime.datetime(2024, 12, 9, 16, 21, 30, tzinfo=), delete_chat_photo=False, entities=(MessageEntity(length=6, offset=0, type=),), from_user=User(first_name='Obi', id=708838660, is_bot=False, language_code='uk', last_name='Van', username='ObiVan1978'), group_chat_created=False, message_id=649, supergroup_chat_created=False, text='/start'), update_id=239384372) 2024-12-09 16:25:05,565: Получен webhook запрос 2024-12-09 17:34:05,379: Получен webhook запрос 2024-12-09 17:34:05,381: Получен update: Update(message=Message(channel_chat_created=False, chat=Chat(first_name='Obi', id=708838660, last_name='Van', type=, username='ObiVan1978'), date=datetime.datetime(2024, 12, 9, 17, 34, 5, tzinfo=), delete_chat_photo=False, entities=(MessageEntity(length=6, offset=0, type=),), from_user=User(first_name='Obi', id=708838660, is_bot=False, language_code='uk', last_name='Van', username='ObiVan1978'), group_chat_created=False, message_id=652, supergroup_chat_created=False, text='/start'), update_id=239384374) 2024-12-09 17:34:23,344: Получен webhook запрос 2024-12-09 17:34:23,345: Получен update: Update(message=Message(channel_chat_created=False, chat=Chat(first_name='Obi', id=708838660, last_name='Van', type=, username='ObiVan1978'), date=datetime.datetime(2024, 12, 9, 17, 34, 23, tzinfo=), delete_chat_photo=False, entities=(MessageEntity(length=6, offset=0, type=),), from_user=User(first_name='Obi', id=708838660, is_bot=False, language_code='uk', last_name='Van', username='ObiVan1978'), group_chat_created=False, message_id=653, supergroup_chat_created=False, text='/start'), update_id=239384375) 2024-12-09 17:34:44,839: Получен webhook запрос 2024-12-09 17:34:44,841: Получен update: Update(my_chat_member=ChatMemberUpdated(chat=Chat(first_name='Obi', id=708838660, last_name='Van', type=, username='ObiVan1978'), date=datetime.datetime(2024, 12, 9, 17, 34, 44, tzinfo=), from_user=User(first_name='Obi', id=708838660, is_bot=False, language_code='uk', last_name='Van', username='ObiVan1978'), new_chat_member=ChatMemberBanned(status=, until_date=datetime.datetime(1970, 1, 1, 0, 0, tzinfo=), user=User(first_name='freetour_bot', id=7713206299, is_bot=True, username='freetourpro_bot')), old_chat_member=ChatMemberMember(status=, user=User(first_name='freetour_bot', id=7713206299, is_bot=True, username='freetourpro_bot'))), update_id=239384376)'